\section{Categorical semantics of E-Graphs with Bindings}

In this section we introduce the required preliminaries on semilattice-enriched symmetric monoidal categories generated by monoidal theories, and the string diagrammatic formalism we will use to represent them.
We also show a specific case of semilattice-enriched closed monoidal categories and how closed structure interacts with the enrichment structure.

We will consider symmetric monoidal categories generated by \textit{monoidal signatures}.

\begin{definition}

A \textit{monoidal} \textit{signature} $\Sigma = (\Sigma_{O}, \Sigma_{M}, t)$ is given by a set of objects $\Sigma_{O}$, set of generators $\Sigma_{M}$ and a type assignment function $t : \Sigma_{M} \to \Sigma_{O}^{*} \times \Sigma_{O}^{*}$ that assigns lists of input and output types to a given generator.
\end{definition}

\begin{definition}

A set of $\Sigma$-terms generated by monoidal signature $\Sigma$ is given by the following grammar
\[
\tau \coloneqq \phi \;|\; \id_{I} \;|\; \id_{A} \;|\; \sym_{A,B} \;|\; \tau_{1};\tau_{2} \;|\; \tau_{1} \otimes \tau_{2}
\],
where $\phi$ ranges over the set of generators $\Sigma_{M}$ and $A,B$ range over the set of objects $\Sigma_{O}$.
\end{definition}

Identities and symmetries of more complex types, \textit{e.g.}, $\id_{A \otimes B}$ and $\sym_{A \otimes B, C}$, are given by the composition and tensoring of $\id_{A}$ and $\sym_{A,B}$ as, $\textit{e.g.}$, $\id_{A \otimes B} = \id_{A} \otimes \id_{B}$ and $\sym_{A \otimes B, C} = (\id_{A} \otimes \sym_{B,C});(\sym_{A,C} \otimes \id_{B})$.

\begin{definition}
A free symmetric monoidal category $\catname{S}(\Sigma)$ is given by a set of $\Sigma$-terms quotiented by the axioms of a symmetric monoidal category.
The objects are lists of types from $\Sigma_{O}$ with tensoring given by list concatenation.
\end{definition}

\begin{definition}

A symmetric monoidal theory $\catname{SMT}(\Sigma, \mathcal{E})$ is given by a set of $\Sigma$-terms quotiented by a set of equations $\mathcal{E}$ consisting of pairs of appropriately typed $\Sigma$ terms $l = r$.
\end{definition}

\begin{definition}
A categorical presentation of an $\catname{SMT}(\Sigma, \mathcal{E})$ is a free symmetric monoidal category $\catname{S}(\Sigma, \mathcal{E})$ given by a set of $\Sigma$ terms quotiented by the laws of a symmetric monoidal category and equations of $\mathcal{E}$.
\end{definition}

We can similarly consider \textit{closed} terms that give rise to a free \textit{closed} symmetric monoidal category.

\begin{definition}
\label{def:closed}
A monoidal (right) closed category is a monoidal category $\catname{C}$ satisfying for
every pair of objects $B,C$ there is an object $B \multimap C$ and a morphism $\textbf{ev}_{B,C} : (B \multimap C) \otimes B \to
C$, and for every triple of objects $A,B,C$ there is an operation $\Lambda_{A,B,C} : \catname{C}(A \otimes B,C) \to
\catname{C}(A,B \multimap{} C)$ satisfying the following equations for all $f : A \otimes B \to C$ and $g : Z \to A$:
\begin{itemize}
\item $f = \Lambda_{A,B,C}(f) \otimes \id_{B}; \textbf{ev}_{B,C}$
\item $\id_{B \multimap{} C} = \Lambda_{B \multimap{} C,B,C}(\textbf{ev}_{B,C})$
\item $\Lambda_{Z,B,C}(g \otimes \id_{B}; f) = g;\Lambda_{A,B,C}(f)$
\end{itemize}
\end{definition}

This definition is equivalent to the more usual one that defines a (right) closed category through a pair of adjoint functors $- \otimes B$ and $B \multimap{} -$~\cite{ghica-zanassi2023string}.
If the tensor is symmetric, then the category is simply \textit{closed}.

\begin{definition}

\textit{Closed} $\Sigma$-terms are defined inductively by first defining a family of objects $obj_{\Sigma_{O}}$.
\begin{itemize}
\item A designated $I$ is in $obj_{\Sigma_{O}}$.
\item If $A \in obj_{\Sigma_{O}}$ and $B \in obj_{\Sigma_{O}}$, then $A \otimes B \in obj_{\Sigma_{O}}$ and $A \multimap B \in obj_{\Sigma_{O}}$.
\end{itemize}
A family of closed $\Sigma$ terms is then defined as
\begin{itemize}
    \item $\phi : A \to B \in \Sigma_{M}$ is a closed $\Sigma$-term.
    \item If $A$ and $B$ are $obj_{\Sigma_{O}}$, then $\id_{A}$ and $\sym_{A,B}$ are closed $\Sigma$-terms.
    \item If $f : A \to B$ and $g : B \to C$ are closed $\Sigma$-terms, then so is $f;g : A \to C$. 
    \item If $f : A \to B$ and $g : C \to D$ are closed $\Sigma$-terms, then so is $f \otimes g : A \otimes C \to B \otimes D$.
    \item If $A$ and $B$ are $obj_{\Sigma_{O}}$, then $\textbf{ev}_{A,B} : A \multimap B \otimes A \to B$ is a closed $\Sigma$-term.
    \item If $h : X \otimes A \to B$ is a closed $\Sigma$-term, then $\Lambda_{X,A,B}(h) : X \to (A \multimap B)$ is a closed $\Sigma$-term.
\end{itemize}
\end{definition}

\begin{definition}
The free closed symmetric monoidal category $\catname{CS}(\Sigma)$ is given by a set of closed $\Sigma$-terms quotiented by the laws of a symmetric monoidal category and the equations from Definition~\ref{def:closed}.
\end{definition}

To encode equivalences between morphisms (or $\Sigma$-terms), the hom-sets of the corresponding free categories can be endowed with additional structure of a semilattice induced by an idempotent, commutative and associative operator $+$.
This endowment turns such categories into $\catname{SLat}$-enriched categories where $\catname{SLat}$ is a category of \textit{unbounded} semilattices and homomorphisms between them (see Appendix section~\ref{sec:appendix:1}).

\begin{definition}[Semilattice-enriched category]
    A semilattice-enriched category $\mathbb{C}$ is defined by the following data
    \begin{itemize}
        \item a set of objects $\mathbb{C}$
        \item for every pair of objects $A,B \in \mathbb{C}$ --- a hom-object (or, hom-semilattice) $\mathbb{C}(A,B) \in \catname{SLat}$
        \item for every triple of objects $A,B,C \in \mathbb{C}$ --- a composition morphism
        \[
            \circ: \mathbb{C}(B,C) \otimes \mathbb{C}(A,B) \to \mathbb{C}(A,C)
        \]
        \item for every object $A \in C$ --- a unit morphism
        \[
        u_{A} : I \to \mathbb{C}(A,A), \text{ where $I$ is the monoidal unit for $\catname{SLat}$}
        \]
    \end{itemize}
    such that particular coherence diagrams commute~\cite{Borceux_1994}.
\end{definition}

\begin{definition}[$\catname{SLat}$-functor]
	Let $\mathbb{C}$ and $\mathbb{D}$ be two $\catname{SLat}$-categories.
	An $\catname{SLat}$-functor $F : \mathbb{C} \to \mathbb{D}$ is defined by the following data.
	\begin{itemize}
	  \item A mapping $F : \mathbb{C} \to \mathbb{D}$
	  \item An object-indexed family of morphisms in $\catname{SLat}$ $F_{A,B} : \mathbb{C}(A,B) \to \mathbb{D}(FA,FB)$
	\end{itemize}
	such that certain coherence diagrams commute~\cite{Borceux_1994}.
	$F$ being a morphism in $\catname{SLat}$ has a property $F(f + g) = F(f) + F(g)$.
\end{definition}


\begin{definition}[Semilattice-enriched SMC]\label{def:enriched-prop}
    A \textit{semilattice enriched strict SMC}  $\mathbb{C}$ is given by a semilattice-enriched category $\mathbb{C}$ as above that additionally has
    \begin{itemize}
    \item a unit object $I_{C} \in \mathbb{C}$
    \item for every pair of objects $A,B \in \mathbb{C}$ --- an object $A \otimes B \in \mathbb{C}$
    \item for all $A,B,C,D$ --- a tensor morphism $ - \otimes_{C} - : \mathbb{C}(A,C) \otimes \mathbb{C}(B,D) \to \mathbb{C}(A \otimes B, C \otimes D)$
    \end{itemize}
    such that particular coherence diagrams commute~\cite{enriched_monoidal}.
    \end{definition}
    The latter morphism being in $\catname{SLat}$ implies the following equations that $\otimes$ satisfy
    \[
    f \otimes (g+h) = f \otimes g + f \otimes h \qquad (f+g) \otimes h = f \otimes h + g \otimes h
    \]
    
    Again, we take $\otimes$ to bind more tightly than $+$.
    
    \begin{proposition}(A specialized case of Proposition 6.4.7~\cite{Borceux_1994})
    There is a 2-adjunction 
    % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXGNhdG5hbWV7U0xhdHR9LVxcY2F0bmFtZXtDYXR9Il0sWzIsMCwiXFxjYXRuYW1le0NhdH0iXSxbMSwwLCJGIiwyLHsiY3VydmUiOjR9XSxbMCwxLCJHIiwyLHsiY3VydmUiOjR9XSxbMiwzLCIiLDAseyJsZXZlbCI6MSwic3R5bGUiOnsibmFtZSI6ImFkanVuY3Rpb24ifX1dXQ==
    \[\begin{tikzcd}
        \catname{SLat}\text{--}\catname{Cat}\arrow[rr, "\mathcal{U}", bend left] & \hspace{-1em}\top & \catname{Cat} \arrow[ll, "\mathcal{F}", bend left]
        \end{tikzcd}
    \]
    that is induced by a usual free-forgetful adjunction 
    
    \[\begin{tikzcd}
        \catname{SLat} \arrow[rr, "U", bend left] & \top & \catname{Set} \arrow[ll, "F", bend left]
        \end{tikzcd}
    \]
    \end{proposition}
    
In particular, 2-functor $\mathcal{F}$ turns every category $\mathbb{C'} \in \catname{Cat}$ into a free semilattice enriched $\mathbb{C} \in \catname{SLat}\text{--}\catname{Cat}$ by making every hom-set of $\mathbb{C'}$ into a free semilattice on this set.
Being a 2-functor it also lifts an adjunction in $\catname{Cat}$ $F \dashv G$ into an $\catname{Slat}$-adjunction.
Thus, applying the functor to $\catname{CS}(\Sigma)$ we get a closed symmetric monoidal $\catname{Slat}$-category $\catname{CS}(\Sigma)^{+}$ by lifting the adjunction $(- \otimes B, B \multimap{} -, \eta, \varepsilon)$.
We can similarly derive $\catname{SLat}$-enriched versions of  $\Lambda_{A,B,C}$ and $\textbf{ev}_{A,B}$ morphisms using the lifted adjunction as $\textbf{ev}_{A,B} = \varepsilon_{A}$ and $\Lambda_{A,B,C}(f) = \eta; (B \multimap{} f)$.
The following equation can then be derived which will be useful in encoding equivalences inside abstractions.
\begin{align*}
\Lambda_{A,B,C}(f + g) &= \eta;(B \multimap (f + g))\\
                       &= \eta;(B \multimap (f) + B \multimap (g))\\
                       &= \eta;(B \multimap (f)) + \eta;(B \multimap (g))\\
                       &= \Lambda_{A,B,C}(f) + \Lambda_{A,B,C}(g)
\end{align*}

Similar to $\catname{CS}(\Sigma)$, $\catname{CS}(\Sigma)^{+}$ can be freely generated from a set of $\Sigma^{+}$-terms.
