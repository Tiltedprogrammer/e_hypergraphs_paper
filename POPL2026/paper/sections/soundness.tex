\section{Soundness and completeness}

In this section we explore soundness and completeness of EDPOI rewriting with respect to rewriting of closed $\Sigma^{+}$-terms.
First we recall the rewriting of $\Sigma$-terms modulo the laws of symmetric monoidal categories.

\begin{definition}[Closed $\Sigma$-term rewrite rule]
	A $\Sigma$-term rewrite rules is a pair $\langle l, r \rangle$ where $l$ and $r$ are $\Sigma$ terms with matching inputs and outputs (as lists of input and output types).
	When $l$ and $r$ are closed $\Sigma$-terms, we call such a rewrite rule closed.
\end{definition}

\begin{definition}%
	\label{def:rewrite}
	We say that a $\Sigma$-term $f$ rewrites to a $\Sigma$-term $g$ modulo the laws of symmetric monoidal categories via a rewrite rule $\langle l, r \rangle$, writing $\leadsto_{\langle l, r \rangle}$, if they are representable as
	$
		f = c_{1};(id_{k} \otimes l);c_{2} $ and $ g = c_{1};(id_{k} \otimes r);c_{2}
	$.
\end{definition}
This notion generalises to rewriting of closed $\Sigma$-terms.

\begin{definition}
	For closed-$\Sigma$-terms $f,g$, and a closed rewrite rule $\langle l, r \rangle$, $f \leadsto_{\langle l, r \rangle} g$ modulo the laws of symmetric monoidal categories if they are representable as either in~\autoref{def:rewrite}, or as
	$
		f = c_{1};(id_{k} \otimes d);c_{2} $ and $ g = c_{1};(id_{k} \otimes e);c_{2}
	$
	and $d \leadsto_{\langle l, r \rangle} e$
\end{definition}
\begin{lemma}
	\label{lemma:normal_form}
	Every closed $\Sigma^{+}$ term $f$ can be equivalently represented as
	$
		f_{1} + \ldots + f_{n}
	$ modulo the laws of symmetric monoidal $\catname{SLat}$-categories and distributivity law (\autoref{law:distributivity}) where none of $f_{i}$ contain the join operator.
\end{lemma}
% \begin{proof}
% Such forms are given by orienting $\catname{SLat}$-equations such that $+$ gets propagated to the top, as, for example $f \otimes (g + h) = f \otimes g + g \otimes h$.
% Most notably, we can also escape lambda abstractions by using the distributivity law (\autoref{law:distributivity}).
% \end{proof}
This takes us to the following definition of rewriting for closed $\Sigma^{+}$-terms.
\begin{definition}
	For closed $\Sigma^{+}$-term $f,g$, and a closed $\Sigma$-term rewrite rule $\langle l, r \rangle$ $f \leadsto_{\langle l, r \rangle}$ modulo the laws of symmetric monoidal $\catname{SLat}$-categories and distributivity law (\autoref{law:distributivity}) if they are representable as
	$
		f = f_{1} + \ldots + f_{i} + \ldots + f_{n} $ and $ g = f_{1} + \ldots + f_{j} + \ldots + f_{n}
	$
	such that there is a permutation $\sigma$ such that there exist indices $i,j$ and $\sigma(f_{i}) \leadsto f_{j}$.
\end{definition}
Note that the rewrite rule consist of closed $\Sigma$-terms and not closed $\Sigma^{+}$-terms, i.e. neither $l$ nor $r$ contain any $+$.
This is intentional as there rewrite rules are supposed to be domain-specific (like a rule $\langle 2 \otimes id;times, id \otimes 1; <\;\;< \rangle$) and not related to the free enrichment.

Next, to formulate the correspondence between rewriting systems we first define interpretation $\llbracket - \rrbracket$ of closed $\Sigma^{+}$ terms in $\WellTypedMdaEcospans$.
It follows by first defining the interpretation of operators by extending the interpretation of plain $\Sigma$ terms as morphisms in $\MdaCospans$ as given in~\autoref{sec:appendix:interpretation}.
The only missing cases, $\llbracket \textsf{ev}_{A,B} \rrbracket$ and $\llbracket \Lambda_{A,B,C} \rrbracket$, are given in~\autoref{fig:ev_and_lambda}.

\begin{figure}
	\begin{subfigure}[c]{0.45\linewidth}
		\[
			\adjustbox{scale=0.6}{
				\tikzfig{./figures/ev_interpretation_2}
			}
		\]
	\end{subfigure}
	\hfill
	\begin{subfigure}[c]{0.45\linewidth}
		\[
			\adjustbox{scale=0.6}{
				\tikzfig{./figures/lambda_interpretation_2}
			}
		\]
	\end{subfigure}
	\caption{$\llbracket \textsf{ev} \rrbracket$ (left) and $\llbracket \Lambda(f) \rrbracket$ (right)}
	\label{fig:ev_and_lambda}
\end{figure}

Then we can make $\WellTypedMdaEcospans$ into $\catname{SLat}$-category by defining a join of two cospans and introducing EDPOI rewrite rules to satisfy the laws of symmetric monoidal $\catname{SLat}$-categories.
We also add a structural rewrite schema rule corresponding to the distributivity law (\autoref{law:distributivity}).
The join of two cospans is defined as in~\autoref{fig:f+g} and the quotienting is done through EDPOI rewrite schema rules, one for each axiom.
For example, the distributivity rule for $\otimes$ is given by the following schema rule
\ifdefined\ONECOLUMN
	\[
		\adjustbox{width=0.7\linewidth}{
			\tikzfig{./figures/semilattice_rule_1_2}~.
		}
	\]
\else
	\[
		\adjustbox{width=\linewidth}{
			\tikzfig{./figures/semilattice_rule_1_2}~.
		}
	\]
\fi

We collect all such rewrite schemas into a set $\mathcal{S}$ and then determine a symmetric monoidal $\catname{SLat}$-category $\WellTypedMdaEcospans / \mathcal{S}$ by this quotienting.
Note that it is not a \emph{closed} symmetric monoidal $\catname{SLat}$-category.
To make it so, we would need to also quotient by the DPO rewrites that arise from the equations in~\autoref{def:closed}.
We do not perform such quotienting as these equations bear operational meaning, i.e.\ they model $\beta$-reduction when interpreting $\lambda$-calculus.

\begin{definition}[Quotient by rewrites]
	Given a set of EDPOI rewrite rules $\mathcal{E}$,  we denote by $\WellTypedMdaEcospans/\mathcal{E}$ the $\catname{SLat}$-category $\WellTypedMdaEcospans$ quotiented by the relation $f \sim g \quad \text{if} \quad f \Rrightarrow^{*}_{\mathcal{E}} g$.
\end{definition}

This explicit quotienting allows us to only consider cospans of the form $f_1 + \ldots + f_{n}$, similar to~\autoref{lemma:normal_form}, such that carrier of $f_{i}$ does not contain any hierarchical edges from $\textcolor{e-color}{E}$.

$\llbracket - \rrbracket$ is then induced by its definition on operators by induction
\[
	\llbracket f;g \rrbracket = \llbracket f \rrbracket ; \llbracket g \rrbracket \quad
	\llbracket f \otimes g \rrbracket = \llbracket f \rrbracket \otimes \llbracket g \rrbracket \quad
	\llbracket f + g \rrbracket = \llbracket f \rrbracket + \llbracket g \rrbracket
\]

\begin{proposition}[Proposition 26 and Proposition 27~\cite{fscd}]
	\label{prop:fscd}
	For two closed $\Sigma$-terms $f$ and $g$ and an $\mathcal{E}$ equation $l = r$,  $f \leadsto_{\langle l, r \rangle} g$ if and only if $\llbracket f \rrbracket \Rrightarrow_{\langle \llbracket l \rrbracket, \llbracket r \rrbracket \rangle} \llbracket g \rrbracket$, where the latter is defined in a sub $\catname{SLat}$-category of $\WellTypedMdaEcospans$ where carriers only contain edges from $\colorbox{yellow}{E} \cup \textcolor{closed-color}{E}$.
\end{proposition}

\begin{proposition}%
	\label{prop:quotient-structural}
	For two closed $\Sigma^{+}$-terms $f$ and $g$ and an $\mathcal{E}$ equation $l = r$,  $f \leadsto_{\langle l, r \rangle} g$ if and only if $\llbracket f \rrbracket \Rrightarrow_{\langle \llbracket l \rrbracket, \llbracket r \rrbracket \rangle} \llbracket g \rrbracket$ in $\WellTypedMdaEcospans / \mathcal{S}$.
\end{proposition}
\begin{proof}
	By definition, we have
	$
		f = f_{1} + \ldots + f_{n} $ and $  g = f_{1} + \ldots + f_{n}$,
	such that $f_{i} \leadsto f_{j}$ for some $i, j$.
	This yields two cospans of the form $\llbracket f_{1} \rrbracket + \ldots + \llbracket f_{n} \rrbracket$ for $\llbracket f \rrbracket$ and $\llbracket g \rrbracket$ and, by noting that every $f_{i}$ is a $\Sigma$-term, and carriers in every $\llbracket f_{i} \rrbracket$ have no edges from $\textcolor{e-color}{E}$, we can apply~\autoref{prop:fscd}.
\end{proof}

Practically, this quotienting means that we perform DPO rewrites modulo the equations of SMC and modulo the law~\ref{law:distributivity}.
We can either rewrite the normal forms as mentioned above that contain all possible redexes, or we can genuinely search for redexes modulo these laws by traversing the e-hypergraph through both types of boxes when searching for a redex, which makes this representation practically viable even though it does not absorb all the possible equations.

\begin{figure}
	\[
		\adjustbox{scale=0.5}{
			\tikzfig{./figures/f_plus_g_new_2}
		}
	\]
	\captionsetup{belowskip=-1ex}
	\caption{$+$ of two morphisms in $\WellTypedMdaEcospans$}
	\label{fig:f+g}
\end{figure}
